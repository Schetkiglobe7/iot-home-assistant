persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log

listener 1883
allow_anonymous false

# Specifica il plugin go-auth
plugin /mosquitto/plugins/go-auth.so

# Configura il backend per MySQL
auth_opt_backends mysql

auth_opt_mysql_host mysql
auth_opt_mysql_port 3306
auth_opt_mysql_dbname mosquitto_db
auth_opt_mysql_user mosquitto_user
auth_opt_mysql_password secure_password

auth_opt_mysql_userquery SELECT password_hash FROM mqtt_users WHERE username = ?
auth_opt_mysql_superquery SELECT COUNT(*) FROM mqtt_users WHERE username = ? AND is_admin = true
auth_opt_mysql_aclquery SELECT topic FROM mqtt_acl WHERE username = ? AND (rw >= ?)